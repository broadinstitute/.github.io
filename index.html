<!DOCTYPE html>
<html>

<head>
    <!--boiler plate for html page-->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./index.css">
    <script src="./index.js" defer></script>
</head>

<body>
    <!--get the csv files to pull data from-->
    <form id="myForm"> 
        <input type="file" id="csvFile" accept=".csv" aria-label="csvFile" multiple="true"/>
        <br />
        <!--show the checkboxes of data to display-->
        <input type="submit" value="Submit" onClick="show_selection()"/>
    </form>

<!--display the list of fields that can be used-->
<button type="button" id="cbox_button" style="display: none;" onclick="write_checkboxes()">
    Open Checkbox Selection
</button>

<!--designate part of page that checkboxes for available fields and 
    pkrs will be written in-->
<div id="boxes" style="display: none;" class="containerb">
    <div class="subbox" id="cboxes" style="display: block"> </div>
    <div class="subbox" id="pkr_cboxes" style="display: block;"></div>
</div>

<input type="checkbox" id = "round_nums" name = "round_nums" value = "val" onClick = "toggle_round_wrapper(document.getElementById('data_table'))">
<label for="round_nums"> Show rounded</label> 
<input type="checkbox" id = "transpose" name = "transpose" value = "val" onClick = "transpose_table(document.getElementById('data_table'))">
<label for="round_nums"> Transpose</label> <br>


<!--make button to bring up checkboxes when they are hidden-->
<button id="box_display" style="display: none" onclick="toggle_show()"> Show options</button>

<!--filter a column by a user given value-->
<div id="filter_options" style="display: none">
<form>
    <!--get the name of field to filter and threshold value-->
    <label for="data_field">Field to Color by Standard Deviation:</label><br>
    <input type="text" list="filtration_options" id="data_field" name="data_field" autocomplete="off"><br>
    <label for="f_val">Mean for Standard Deviation Calculation:</label><br>
    <input type="text" id="f_val" name="f_val"> <br>
    
    <!--get the filtering direction
    <input type="radio" name="direction" value="greater" id="greater">
    <label for="greater" > > </label>
    <input type="radio" name="direction" value="less" id="less">
    <label for="less" > < </label> 
    <input type="radio" name="direction" value="equal" id="equal">
    <label for="equal" > = </label> <br> -->

    <input type = "submit" value = "Submit" onClick="color_by_mean()"/>
    <input type = "submit" value = "Clear" onClick = "clear_coloring()"/>
</form>
</div>

    <datalist id="filtration_options">
    </datalist>
    
    <!--create table that the checked fields of the csv files will be written in to-->
    <p>
        <div class="container"> 
            <table id="data_table"></table>
        </div>
    </p>

<script>
    //boolean for sorting direction, maybe dont need at this point
    ascending = true
    
    //array to hold the contents of the file 
    file_contents = []
    
    //array to hold the header of the input file (first row, names of data fields)
    header_row = []
    
    //arrays for different forms of table
    table_as_array_unrounded = []
    table_as_array_rounded = []
    table_as_array_transpose = []
    const myForm = document.getElementById("myForm");
    const csvFile = document.getElementById("csvFile");
    
    //read in the form submited by the user
    myForm.addEventListener("submit", function (e, doc_text) {  
        e.preventDefault(); 
        
        /*create an array that, for each provided csv, has one list for the
          first column (names of fields) and one list for the second (values 
          of fields)*/ 
        table_as_array_list = []
        table_as_array = []
        overall_array = []
        names_of_fields = ""
        for (let j = 0; j < csvFile.files.length; j++) {
            overall_array.push([[], []])
        }
        
        //read in the data from each file into a string
        for (let i = 0; i < csvFile.files.length; i++) {
            file = csvFile.files[i]
            const reader = new FileReader();
            reader.onload = function (e) { 
                const text = e.target.result; 
                /*break up string of all file contants by newline, so each 
                  member of text_lines is a row of the csv*/
                const text_lines = text.split(/\r?\n/)
                /*break up one row of the csv into the first column (name) and
                  the second column (value)*/
                text_line = ""
                names_of_fields = ""
                list_line = []
                names_of_fields_list = []
                for (line of text_lines) {
                    if (line) {
                        //seperate line of csv into name of field and field 
                        //itself
                        const line_split = line.split(',')
                        overall_array[i][0].push(line_split[0])
                        overall_array[i][1].push(line_split[1])
                        //take all values from one file and make a string 
                        text_line += line_split[1] + ','
                        names_of_fields += line_split[0] + ','
                        //take all values from one file and make an array
                        list_line.push(line_split[1])
                        names_of_fields_list.push(line_split[0])

                    } 
                }
                //on fisrt iteration of loop, save the names of the data fields
                //from the first file. This will populate the starting header, 
                //and are assumed to be the same for each file
                if (i == 0) {
                    file_contents.push(names_of_fields)
                    table_as_array_unrounded.push(names_of_fields_list)
                }
                //save the string and list representations of the data from 
                // the file
                //substring here used to remove the , from the last part of the
                //string
                file_contents.push(text_line.substring(0, text_line.length - 1))
                table_as_array_unrounded.push(list_line)
                //once all the files have been read in, populate global field
                //for the table header
                if (i == (csvFile.files.length - 1)) {
                    names_string = file_contents.shift()
                    names_list = names_string.split(',')
                    pkr = names_list.shift()
                    header_row.push(pkr)
                    //get the pkr value for each file
                    for (line of file_contents) {
                        values = line.split(',')
                        pkr_val = values.shift()
                        header_row.push(pkr_val)
                    }
                    //these are two d arrays. For each row of the table, there
                    //is an array of strings, where each string is one of the 
                    //data fields from the file
                    table_as_array_rounded = round_numeric_values(table_as_array_unrounded)
                    table_as_array = table_as_array_unrounded
                }
            }
            reader.readAsText(file); 
        }

    })

</script>

</body>
</html>
